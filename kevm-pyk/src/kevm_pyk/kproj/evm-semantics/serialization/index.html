<!DOCTYPE html>
<html lang="en">
  <head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0"
/>
<meta
  name="description"
  content="K Semantics of the Ethereum Virtual Machine (EVM)"
/>
<meta
  name="keywords"
  content="runtime, verification, rv, k, ethereum virtual machine, evm"
/>
<meta name="author" content="EVM Semantics | Runtime Verification Inc" />
<meta name="robots" content="index, follow" />

<!--favicon icon-->
<link rel="icon" type="image/png" href="../../../../../../assets/img/favicon.ico" />

<title>KEVM: Semantics of EVM in K | Runtime Verification, Inc. </title>

<link rel="canonical" href="https://jellopaper.org/kevm-pyk/src/kevm_pyk/kproj/evm-semantics/serialization/" />

<!--web fonts-->
<link
  href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css?family=Lora:400i"
  rel="stylesheet"
/>

<link
  href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/css/all.min.css"
  rel="stylesheet"
/>

<link href="../../../../../../assets/css/index.css" rel="stylesheet" />

<!--[if (gt IE 9) |!(IE)]><!-->
<!--<link rel="stylesheet" href="/assets/vendor/custom-nav/css/effects/fade-menu.css"/>-->
<!-- <link rel="stylesheet" href="../../../../../../assets/k/vl-nav/css/effects/slide-menu.css" /> -->
<!--<![endif]-->

  </head>

  <body>
<header
  class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar"
>
  <a class="logo-link" href="../../../../../../index.html"> EVM Semantics </a>
  <ul class="navbar-nav ml-md-auto">
    <li class="nav-item">
      <a
        class="nav-link pl-2 pr-1 mx-1 py-3 my-n2"
        href="https://github.com/runtimeverification/evm-semantics"
        target="_blank"
        rel="noopener"
        aria-label="GitHub"
      >
        <i class="fab fa-github"></i>
      </a>
    </li>
  </ul>
  <!--
  <a
    class="btn btn-rv-blue d-none d-lg-inline-block mb-3 mb-md-0 ml-md-3"
    href="../../../../../../downloads"
    >Download</a
  >
  -->
</header>


    <div class="container-fluid">
      <div class="row flex-xl-nowrap">
<div class="col-12 col-md-3 col-xl-2 bd-sidebar mb-3">
  <form
    role="search"
    class="bd-search d-flex align-items-center justify-content-between"
  >
    <input
      type="search"
      class="form-control"
      placeholder="Search..."
      aria-label="Search for..."
      autocomplete="false"
      id="search-box"
    />
    <button
      class="btn bd-search-docs-toggle d-md-none p-0 ml-3 collapsed"
      type="button"
      aria-label="Toggle docs navigation"
      style="font-size: 1.4rem"
    >
      <i class="fas fa-bars"></i>
    </button>
  </form>
  <nav class="collapse bd-links" aria-label="Main navigation">
    <div class="bd-toc-item">
      <a class="bd-toc-link" href="../../../../../../">Homepage</a>
      <a class="bd-toc-link" href="../../../../../../INSTALL/">Install</a>
    </div>
  </nav>
</div>

        <main
          class="col-12 col-md-6 col-xl-8 py-md-3 pl-md-5 bd-content"
          role="main"
        >
          <div class="markdown-preview"><html><head></head><body><h1 id="parsing%2Funparsing">Parsing/Unparsing</h1>
<pre><code class="language-k"><span class="token keyword">requires</span> <span class="token string">"plugin/krypto.md"</span>
<span class="token keyword">requires</span> <span class="token string">"evm-types.md"</span>
<span class="token keyword">requires</span> <span class="token string">"json-rpc.md"</span>
</code></pre>
<pre><code class="language-k"><span class="token keyword">module</span> SERIALIZATION
    <span class="token keyword">imports</span> KRYPTO
    <span class="token keyword">imports</span> EVM<span class="token operator">-</span>TYPES
    <span class="token keyword">imports</span> STRING<span class="token operator">-</span>BUFFER
    <span class="token keyword">imports</span> JSON<span class="token operator">-</span>EXT
</code></pre>
<h2 id="address%2Fhash-helpers">Address/Hash Helpers</h2>
<ul>
<li><code>keccak</code> serves as a wrapper around the <code>Keccak256</code> in <code>KRYPTO</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> keccak <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>keccak<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> total<span class="token punctuation">,</span> smtlib<span class="token punctuation">(</span>smt_keccak<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>keccak<span class="token punctuation">]</span><span class="token punctuation">:</span> keccak<span class="token punctuation">(</span>WS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>WS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>concrete<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#newAddr</code> computes the address of a new account given the address and nonce of the creating account.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #newAddr <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>         <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>newAddr<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #newAddr <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>newAddrCreate2<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#newAddr<span class="token punctuation">]</span><span class="token punctuation">:</span>        #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> NONCE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>#rlpEncode<span class="token punctuation">(</span><span class="token punctuation">[</span>#addrBytes<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">,</span> NONCE<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                                                                        <span class="token punctuation">[</span>concrete<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>#newAddrCreate2<span class="token punctuation">]</span><span class="token punctuation">:</span> #newAddr<span class="token punctuation">(</span>ACCT<span class="token punctuation">,</span> SALT<span class="token punctuation">,</span> INITCODE<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>b<span class="token string">"\xff"</span> <span class="token operator">+</span>Bytes #addrBytes<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span> <span class="token operator">+</span>Bytes #wordBytes<span class="token punctuation">(</span>SALT<span class="token punctuation">)</span> <span class="token operator">+</span>Bytes #parseByteStack<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>INITCODE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>concrete<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#sender</code> computes the sender of the transaction from its data and signature.</li>
<li><code>sender.pre.EIP155</code>, <code>sender.EIP155.signed</code> and <code>sender.EIP155.unsigned</code> need to adapt the <code>TW</code> value before passing it to the <code>ECDSARecover</code>.</li>
<li><code>sender</code> is used by the <code>ecrec</code> precompile and does not need to adapt the parameters.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Account <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #sender <span class="token punctuation">(</span> TxData <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>senderTxData<span class="token punctuation">)</span>      <span class="token punctuation">]</span>
                     <span class="token operator">|</span> #sender <span class="token punctuation">(</span> Bytes  <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> Bytes <span class="token punctuation">)</span>       <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> total<span class="token punctuation">]</span>
                     <span class="token operator">|</span> #sender <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span>                              <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>senderReturn<span class="token punctuation">)</span>      <span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>sender<span class="token punctuation">.</span>pre<span class="token punctuation">.</span>EIP155<span class="token punctuation">]</span><span class="token punctuation">:</span>      #sender<span class="token punctuation">(</span>_<span class="token punctuation">:</span>TxData<span class="token punctuation">,</span> TW             <span class="token operator">=&gt;</span> TW <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">27</span>           <span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token keyword">requires</span> TW <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>                orBool TW <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>sender<span class="token punctuation">.</span>EIP155<span class="token punctuation">.</span>signed<span class="token punctuation">]</span><span class="token punctuation">:</span>   #sender<span class="token punctuation">(</span>_<span class="token punctuation">:</span>TxData<span class="token punctuation">,</span> TW             <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>TW <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">35</span><span class="token punctuation">)</span> modInt <span class="token number">2</span><span class="token punctuation">,</span> _<span class="token punctuation">,</span> _<span class="token punctuation">,</span> B<span class="token punctuation">)</span> <span class="token keyword">requires</span> TW <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token operator">*</span><span class="token keyword">Int</span> B <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">35</span> orBool TW <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token operator">*</span><span class="token keyword">Int</span> B <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">36</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>sender<span class="token punctuation">.</span>EIP155<span class="token punctuation">.</span>unsigned<span class="token punctuation">]</span><span class="token punctuation">:</span> #sender<span class="token punctuation">(</span>T<span class="token punctuation">:</span>TxData<span class="token punctuation">,</span> TW<span class="token punctuation">,</span> TR<span class="token punctuation">,</span> TS<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sender<span class="token punctuation">(</span>#hashTxData<span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">,</span> TW<span class="token punctuation">,</span> TR<span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> <span class="token punctuation">[</span>sender<span class="token punctuation">]</span><span class="token punctuation">:</span> #sender<span class="token punctuation">(</span>HT<span class="token punctuation">,</span> TW<span class="token punctuation">,</span> TR<span class="token punctuation">,</span> TS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #sender<span class="token punctuation">(</span>ECDSARecover<span class="token punctuation">(</span>HT<span class="token punctuation">,</span> TW<span class="token punctuation">,</span> TR<span class="token punctuation">,</span> TS<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #sender<span class="token punctuation">(</span>b<span class="token string">""</span><span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Account
    <span class="token keyword">rule</span> #sender<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>Keccak256<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> BYTES <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K b<span class="token string">""</span>
</code></pre>
<ul>
<li><code>#addrFromPrivateKey</code> computes the address of an account given its private key</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #addrFromPrivateKey <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>addrFromPrivateKey<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>addrFromPrivateKey<span class="token punctuation">]</span><span class="token punctuation">:</span> #addrFromPrivateKey <span class="token punctuation">(</span> KEY <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> ECDSAPubKey<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> KEY <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span>concrete<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><code>#blockHeaderHash</code> computes the hash of a block header given all the block data.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #blockHeaderHash<span class="token punctuation">(</span><span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>                                     <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHeaderHash<span class="token punctuation">)</span>                <span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span>Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes                                   <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHashHeaderBytes<span class="token punctuation">)</span>           <span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span><span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>                              <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHeaderHashBaseFee<span class="token punctuation">)</span>         <span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span>Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes                            <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHashHeaderBaseFeeBytes<span class="token punctuation">)</span>    <span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span><span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>                       <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHeaderHashWithdrawals<span class="token punctuation">)</span>     <span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span>Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes                     <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHashHeaderWithdrawalsBytes<span class="token punctuation">)</span><span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span><span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHeaderHashBlobBeacon<span class="token punctuation">)</span>      <span class="token punctuation">]</span>
                 <span class="token operator">|</span> #blockHeaderHash<span class="token punctuation">(</span>Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>blockHashHeaderBlobBeacon<span class="token punctuation">)</span>      <span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> HP<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> #wordBytes<span class="token punctuation">(</span>HP<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HO<span class="token punctuation">)</span><span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>HC<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HR<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HT<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HE<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HM<span class="token punctuation">)</span><span class="token punctuation">,</span> #padToWidth<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>HN<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                  <span class="token punctuation">]</span>
                                                <span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> HP<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> #wordBytes<span class="token punctuation">(</span>HP<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HO<span class="token punctuation">)</span><span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>HC<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HR<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HT<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HE<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HM<span class="token punctuation">)</span><span class="token punctuation">,</span> #padToWidth<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>HN<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HF
                                                  <span class="token punctuation">]</span>
                                                <span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">,</span> WF<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> HP<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">,</span> WF <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">,</span> WF<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> #wordBytes<span class="token punctuation">(</span>HP<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HO<span class="token punctuation">)</span><span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>HC<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HR<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HT<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HE<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HM<span class="token punctuation">)</span><span class="token punctuation">,</span> #padToWidth<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>HN<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HF <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>WF<span class="token punctuation">)</span>
                                                  <span class="token punctuation">]</span>
                                                <span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">,</span> WF<span class="token punctuation">,</span> UB<span class="token punctuation">,</span> EB<span class="token punctuation">,</span> BR<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> HP<span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">,</span> WF<span class="token punctuation">,</span> UB<span class="token punctuation">,</span> EB<span class="token punctuation">,</span> BR<span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #blockHeaderHash<span class="token punctuation">(</span>HP<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span> HO<span class="token punctuation">,</span> HC<span class="token punctuation">,</span> HR<span class="token punctuation">,</span> HT<span class="token punctuation">,</span> HE<span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX<span class="token punctuation">,</span> HM<span class="token punctuation">,</span> HN<span class="token punctuation">,</span> HF<span class="token punctuation">,</span> WF<span class="token punctuation">,</span> UB<span class="token punctuation">,</span> EB<span class="token punctuation">,</span> BR<span class="token punctuation">)</span>
         <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> #wordBytes<span class="token punctuation">(</span>HP<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HO<span class="token punctuation">)</span><span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>HC<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HR<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HT<span class="token punctuation">)</span><span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HE<span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HB<span class="token punctuation">,</span> HD<span class="token punctuation">,</span> HI<span class="token punctuation">,</span> HL<span class="token punctuation">,</span> HG<span class="token punctuation">,</span> HS<span class="token punctuation">,</span> HX
                                                  <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>HM<span class="token punctuation">)</span><span class="token punctuation">,</span> #padToWidth<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>HN<span class="token punctuation">)</span><span class="token punctuation">)</span>
                                                  <span class="token punctuation">,</span> HF <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>WF<span class="token punctuation">)</span> <span class="token punctuation">,</span> UB <span class="token punctuation">,</span> EB <span class="token punctuation">,</span> #wordBytes<span class="token punctuation">(</span>BR<span class="token punctuation">)</span>
                                                  <span class="token punctuation">]</span>
                                                <span class="token punctuation">)</span>
                                    <span class="token punctuation">)</span>
                         <span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#hashTxData</code> returns the Keccak-256 message hash <code>HT</code> to be signed.
The encoding schemes are applied in <code>#rlpEcondeTxData</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #hashTxData <span class="token punctuation">(</span> TxData <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>hashTxData<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #hashTxData<span class="token punctuation">(</span> TXDATA <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Keccak256raw<span class="token punctuation">(</span>                #rlpEncodeTxData<span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> isLegacyTx    <span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #hashTxData<span class="token punctuation">(</span> TXDATA <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Keccak256raw<span class="token punctuation">(</span> b<span class="token string">"\x01"</span> <span class="token operator">+</span>Bytes #rlpEncodeTxData<span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> isAccessListTx<span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #hashTxData<span class="token punctuation">(</span> TXDATA <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Keccak256raw<span class="token punctuation">(</span> b<span class="token string">"\x02"</span> <span class="token operator">+</span>Bytes #rlpEncodeTxData<span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> isDynamicFeeTx<span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #hashTxData<span class="token punctuation">(</span> TXDATA <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Keccak256raw<span class="token punctuation">(</span> b<span class="token string">"\x03"</span> <span class="token operator">+</span>Bytes #rlpEncodeTxData<span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> isBlobTx      <span class="token punctuation">(</span>TXDATA<span class="token punctuation">)</span>
</code></pre>
<p>The EVM test-sets are represented in JSON format with hex-encoding of the data and programs.
Here we provide some standard parser/unparser functions for that format.</p>
<h2 id="parsing">Parsing</h2>
<p>These parsers can interpret hex-encoded strings as <code>Int</code>s, <code>Bytes</code>s, and <code>Map</code>s.</p>
<ul>
<li><code>#parseHexWord</code> interprets a string as a single hex-encoded <code>Word</code>.</li>
<li><code>#parseHexBytes</code> interprets a string as a hex-encoded stack of bytes.</li>
<li><code>#alignHexString</code> makes sure that the length of a (hex)string is even.</li>
<li><code>#parseByteStack</code> interprets a string as a hex-encoded stack of bytes, but makes sure to remove the leading "0x".</li>
<li><code>#parseWordStack</code> interprets a JSON list as a stack of <code>Word</code>.</li>
<li><code>#parseMap</code> interprets a JSON key/value object as a map from <code>Word</code> to <code>Word</code>.</li>
<li><code>#parseAddr</code> interprets a string as a 160 bit hex-endcoded address.</li>
<li><code>#parseAccessListStorageKeys</code> interprets a JSON list object as a Set, casting each string element as a <code>Word</code>.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseWord    <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#parseWord<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #parseHexWord <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseHexWord<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>   <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseHexWord<span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    <span class="token operator">=&gt;</span> String2Base<span class="token punctuation">(</span>replaceAll<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token string">"0x"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> <span class="token punctuation">(</span>S <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">String</span> <span class="token string">""</span><span class="token punctuation">)</span> andBool <span class="token punctuation">(</span>S <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">String</span> <span class="token string">"0x"</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #parseWord<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">2</span> andBool substrString<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">String</span> <span class="token string">"0x"</span>
    <span class="token keyword">rule</span> #parseWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> String2Int<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #alignHexString <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#alignHexString<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> total<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #alignHexString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> S             <span class="token keyword">requires</span>         lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> modInt <span class="token number">2</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> #alignHexString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">"0"</span> <span class="token operator">+</span><span class="token keyword">String</span> S <span class="token keyword">requires</span> notBool lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> modInt <span class="token number">2</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseHexBytes     <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>parseHexBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #parseHexBytesAux  <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>parseHexBytesAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #parseByteStack    <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>parseByteStack<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">,</span> memo<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseByteStack<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseHexBytes<span class="token punctuation">(</span>replaceAll<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token string">"0x"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseHexBytes<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> #parseHexBytesAux<span class="token punctuation">(</span>#alignHexString<span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #parseHexBytesAux<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bytes
    <span class="token keyword">rule</span> #parseHexBytesAux<span class="token punctuation">(</span>S<span class="token punctuation">)</span>  <span class="token operator">=&gt;</span> Int2Bytes<span class="token punctuation">(</span>lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">2</span><span class="token punctuation">,</span> String2Base<span class="token punctuation">(</span>S<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BE<span class="token punctuation">)</span> <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">2</span>

    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseMap <span class="token punctuation">(</span> JSON <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#parseMap<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseMap<span class="token punctuation">(</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span>JSONs                      <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Map
    <span class="token keyword">rule</span> #parseMap<span class="token punctuation">(</span> <span class="token punctuation">{</span> _   <span class="token punctuation">:</span> <span class="token punctuation">(</span>VALUE<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> REST <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseMap<span class="token punctuation">(</span><span class="token punctuation">{</span> REST <span class="token punctuation">}</span><span class="token punctuation">)</span>                                                <span class="token keyword">requires</span> #parseHexWord<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">0</span>
    <span class="token keyword">rule</span> #parseMap<span class="token punctuation">(</span> <span class="token punctuation">{</span> KEY <span class="token punctuation">:</span> <span class="token punctuation">(</span>VALUE<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> REST <span class="token punctuation">}</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseMap<span class="token punctuation">(</span><span class="token punctuation">{</span> REST <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">[</span> #parseHexWord<span class="token punctuation">(</span>KEY<span class="token punctuation">)</span> &lt;<span class="token operator">-</span> #parseHexWord<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token punctuation">]</span> <span class="token keyword">requires</span> #parseHexWord<span class="token punctuation">(</span>VALUE<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token number">0</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseAddr <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#parseAddr<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseAddr<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #addr<span class="token punctuation">(</span>#parseHexWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span>

   <span class="token keyword">syntax</span> List <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseAccessListStorageKeys <span class="token punctuation">(</span> JSONs <span class="token punctuation">)</span>        <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#parseAccessListStorageKeys<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #parseAccessListStorageKeys <span class="token punctuation">(</span> JSONs <span class="token punctuation">,</span> List <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#parseAccessListStorageKeysAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseAccessListStorageKeys<span class="token punctuation">(</span> J                           <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseAccessListStorageKeys<span class="token punctuation">(</span>J<span class="token punctuation">,</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseAccessListStorageKeys<span class="token punctuation">(</span><span class="token punctuation">[</span>S<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> REST <span class="token punctuation">]</span><span class="token punctuation">,</span> RESULT<span class="token punctuation">:</span>List<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #parseAccessListStorageKeys<span class="token punctuation">(</span><span class="token punctuation">[</span>REST<span class="token punctuation">]</span><span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>#asWord<span class="token punctuation">(</span>S<span class="token punctuation">)</span><span class="token punctuation">)</span> RESULT <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #parseAccessListStorageKeys<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token punctuation">.</span>JSONs       <span class="token punctuation">]</span><span class="token punctuation">,</span> RESULT<span class="token punctuation">:</span>List<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> RESULT
</code></pre>
<h2 id="unparsing">Unparsing</h2>
<ul>
<li><code>#padByte</code> ensures that the <code>String</code> interpretation of a <code>Int</code> is wide enough.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #padByte <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#padByte<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #padByte<span class="token punctuation">(</span> S <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> S             <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">2</span>
    <span class="token keyword">rule</span> #padByte<span class="token punctuation">(</span> S <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">"0"</span> <span class="token operator">+</span><span class="token keyword">String</span> S <span class="token keyword">requires</span> lengthString<span class="token punctuation">(</span>S<span class="token punctuation">)</span> <span class="token operator">==</span>K <span class="token number">1</span>

    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #unparseQuantity <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#unparseQuantity<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #unparseQuantity<span class="token punctuation">(</span> I <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token string">"0x"</span> <span class="token operator">+</span><span class="token keyword">String</span> Base2String<span class="token punctuation">(</span>I<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> <span class="token keyword">String</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #unparseData      <span class="token punctuation">(</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> <span class="token keyword">Int</span>  <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#unparseData     <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                    <span class="token operator">|</span> #unparseDataBytes <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span>     <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#unparseDataBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #unparseData<span class="token punctuation">(</span> DATA<span class="token punctuation">,</span> LENGTH <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #unparseDataBytes<span class="token punctuation">(</span>#padToWidth<span class="token punctuation">(</span>LENGTH<span class="token punctuation">,</span>#asByteStack<span class="token punctuation">(</span>DATA<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #unparseDataBytes<span class="token punctuation">(</span> DATA <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> replaceFirst<span class="token punctuation">(</span>Base2String<span class="token punctuation">(</span>#asInteger<span class="token punctuation">(</span>#asByteStack<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes DATA<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"0x"</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>#addrBytes</code> Takes an Account and represents it as a 20-byte wide Bytes (or an empty Bytes for a null address)</li>
<li><code>#addrBytesNotNil</code> Takes an Account and represents it as a 20-byte wide Bytes. It throws an error if the account is null.</li>
<li><code>#wordBytes</code> Takes an Int and represents it as a 32-byte wide Bytes</li>
<li><code>#parseList2JSONs</code> Takes a List of Bytes and represents it as a JSON array.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #addrBytes <span class="token punctuation">(</span> Account <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#addrBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #wordBytes <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>     <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#wordBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #addrBytes<span class="token punctuation">(</span><span class="token punctuation">.</span>Account<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bytes
    <span class="token keyword">rule</span> #addrBytes<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #padToWidth<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> #rangeAddress<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #wordBytes<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span>     <span class="token operator">=&gt;</span> #padToWidth<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> #rangeUInt<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> WORD<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> JSONs <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #parseList2JSONs <span class="token punctuation">(</span> List <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
  <span class="token comment">// ----------------------------------------------------</span>
    <span class="token keyword">rule</span> #parseList2JSONs<span class="token punctuation">(</span> <span class="token punctuation">.</span>List <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>JSONs
    <span class="token keyword">rule</span> #parseList2JSONs<span class="token punctuation">(</span> ListItem<span class="token punctuation">(</span>X<span class="token punctuation">:</span>Bytes<span class="token punctuation">)</span> REST <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X <span class="token punctuation">,</span> #parseList2JSONs<span class="token punctuation">(</span>REST<span class="token punctuation">)</span>
</code></pre>
<h1 id="recursive-length-prefix-(rlp)">Recursive Length Prefix (RLP)</h1>
<p>RLP encoding is used extensively for executing the blocks of a transaction.
For details about RLP encoding, see the <a href="http://gavwood.com/paper.pdf" target="_blank" rel="noreferrer noopener">YellowPaper Appendix B</a>.</p>
<h2 id="encoding">Encoding</h2>
<ul>
<li><code>#rlpEncodeInt</code> RLP encodes an arbitrary precision integer.</li>
<li><code>#rlpEncodeWord</code> RLP encodes a 256-bit wide EVM word.</li>
<li><code>#rlpEncodeAddress</code> RLP encodes a 160-bit wide Ethereum address (or the null address: .Account).</li>
<li><code>#rlpEncodeBytes</code> RLP encodes a Bytes.</li>
<li><code>#rlpEncodeString</code> RLP encodes a String. All code points must be less than <code>U+00FF</code>, and <code>U+00HH</code> is treated as the byte <code>0xHH</code>.</li>
<li><code>#rlpEncode( JSON )</code> can take a JSON array and make an rlp encoding. It must be a JSON array! JSON objects aren't supported.
example: <code>#rlpEncode( [ 0, 1, 1, "", #parseByteStack("0xef880") ] )</code></li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeInt <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>              <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeInt    <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeWord <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>             <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeWord   <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeAddress <span class="token punctuation">(</span> Account <span class="token punctuation">)</span>      <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeString <span class="token punctuation">(</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>        <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeString <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeBytes <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span>          <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeBytes  <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncode <span class="token punctuation">(</span> JSON <span class="token punctuation">)</span>                <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncode       <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncode <span class="token punctuation">(</span> JSONs<span class="token punctuation">,</span> StringBuffer <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeJsonAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpEncodeInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token string">"\x80"</span>
    <span class="token keyword">rule</span> #rlpEncodeInt<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #asByteStack<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token keyword">requires</span> WORD &gt;<span class="token keyword">Int</span> <span class="token number">0</span> andBool WORD &lt;<span class="token keyword">Int</span> <span class="token number">128</span>
    <span class="token keyword">rule</span> #rlpEncodeInt<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeBytes<span class="token punctuation">(</span>#asByteStack<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> WORD <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">128</span>

    <span class="token keyword">rule</span> #rlpEncodeWord<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeBytes<span class="token punctuation">(</span>#wordBytes<span class="token punctuation">(</span>WORD<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeAddress<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeBytes<span class="token punctuation">(</span>#addrBytes<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeString<span class="token punctuation">(</span>STR<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeBytes<span class="token punctuation">(</span>String2Bytes<span class="token punctuation">(</span>STR<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token string">"\x80"</span>                    <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span>  &lt;<span class="token keyword">Int</span> <span class="token number">1</span>
    <span class="token keyword">rule</span> #rlpEncodeBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> BYTES                      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span> andBool #asInteger<span class="token punctuation">(</span>substrBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">128</span>
    <span class="token keyword">rule</span> #rlpEncodeBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> JSON <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> Bytes
    <span class="token keyword">rule</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> J<span class="token punctuation">:</span>JSONs <span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span> #rlpEncode<span class="token punctuation">(</span>J<span class="token punctuation">,</span> <span class="token punctuation">.</span>StringBuffer<span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token number">192</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">.</span>JSONs                   <span class="token punctuation">,</span> BUF <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> String2Bytes<span class="token punctuation">(</span>StringBuffer2String<span class="token punctuation">(</span>BUF<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">(</span>J<span class="token punctuation">:</span><span class="token keyword">Int</span><span class="token punctuation">,</span>       REST<span class="token punctuation">:</span>JSONs<span class="token punctuation">)</span><span class="token punctuation">,</span> BUF <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> BUF <span class="token operator">+</span><span class="token keyword">String</span> Bytes2String<span class="token punctuation">(</span>#rlpEncodeInt<span class="token punctuation">(</span>J<span class="token punctuation">)</span>   <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">(</span>J<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">,</span>    REST<span class="token punctuation">:</span>JSONs<span class="token punctuation">)</span><span class="token punctuation">,</span> BUF <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> BUF <span class="token operator">+</span><span class="token keyword">String</span> Bytes2String<span class="token punctuation">(</span>#rlpEncodeString<span class="token punctuation">(</span>J<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">(</span>J<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span>     REST<span class="token punctuation">:</span>JSONs<span class="token punctuation">)</span><span class="token punctuation">,</span> BUF <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> BUF <span class="token operator">+</span><span class="token keyword">String</span> Bytes2String<span class="token punctuation">(</span>#rlpEncodeBytes<span class="token punctuation">(</span>J<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">[</span> J <span class="token punctuation">]</span><span class="token punctuation">,</span>       REST<span class="token punctuation">:</span>JSONs<span class="token punctuation">)</span><span class="token punctuation">,</span> BUF <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span>REST<span class="token punctuation">,</span> BUF <span class="token operator">+</span><span class="token keyword">String</span> Bytes2String<span class="token punctuation">(</span>#rlpEncode<span class="token punctuation">(</span><span class="token punctuation">[</span> J <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeLength <span class="token punctuation">(</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>         <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeLength<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeLength <span class="token punctuation">(</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeLengthAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpEncodeLength<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> OFFSET<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #asByteStack<span class="token punctuation">(</span>lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> OFFSET<span class="token punctuation">)</span> <span class="token operator">+</span>Bytes BYTES         <span class="token keyword">requires</span>           lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">56</span>
    <span class="token keyword">rule</span> #rlpEncodeLength<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> OFFSET<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> #asByteStack<span class="token punctuation">(</span>lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span> lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> &lt;<span class="token keyword">Int</span> <span class="token number">56</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncodeLength<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> OFFSET<span class="token punctuation">,</span> BL<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #asByteStack<span class="token punctuation">(</span>lengthBytes<span class="token punctuation">(</span>BL<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> OFFSET <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">55</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes BL <span class="token operator">+</span>Bytes BYTES

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeFullAccount <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Map <span class="token punctuation">,</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeFullAccount<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>rlpAcct<span class="token punctuation">]</span><span class="token punctuation">:</span> #rlpEncodeFullAccount<span class="token punctuation">(</span> NONCE<span class="token punctuation">,</span> BAL<span class="token punctuation">,</span> STORAGE<span class="token punctuation">,</span> CODE <span class="token punctuation">)</span>
                 <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>        #rlpEncodeInt<span class="token punctuation">(</span>NONCE<span class="token punctuation">)</span>
                                      <span class="token operator">+</span>Bytes #rlpEncodeInt<span class="token punctuation">(</span>BAL<span class="token punctuation">)</span>
                                      <span class="token operator">+</span>Bytes #rlpEncodeBytes<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> #rlpEncodeMerkleTree<span class="token punctuation">(</span> #storageRoot<span class="token punctuation">(</span> STORAGE <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                                      <span class="token operator">+</span>Bytes #rlpEncodeBytes<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> CODE <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                                    <span class="token punctuation">,</span> <span class="token number">192</span>
                                    <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeTopics  <span class="token punctuation">(</span> List <span class="token punctuation">,</span> StringBuffer <span class="token punctuation">)</span>      <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeTopics <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeReceipt <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> List <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeReceipt<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeLogs    <span class="token punctuation">(</span> List <span class="token punctuation">)</span>                     <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeLogs   <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpEncodeLogsAux <span class="token punctuation">(</span> List <span class="token punctuation">,</span> StringBuffer <span class="token punctuation">)</span>      <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeLogsAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> <span class="token punctuation">[</span>rlpReceipt<span class="token punctuation">]</span><span class="token punctuation">:</span> #rlpEncodeReceipt<span class="token punctuation">(</span>RS<span class="token punctuation">,</span> RG<span class="token punctuation">,</span> RB<span class="token punctuation">,</span> RL<span class="token punctuation">)</span>
                    <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>        #rlpEncodeInt<span class="token punctuation">(</span>RS<span class="token punctuation">)</span>
                                         <span class="token operator">+</span>Bytes #rlpEncodeInt<span class="token punctuation">(</span>RG<span class="token punctuation">)</span>
                                         <span class="token operator">+</span>Bytes #rlpEncodeBytes<span class="token punctuation">(</span>RB<span class="token punctuation">)</span>
                                         <span class="token operator">+</span>Bytes #rlpEncodeLogs<span class="token punctuation">(</span>RL<span class="token punctuation">)</span>
                                       <span class="token punctuation">,</span> <span class="token number">192</span>
                                       <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeLogs<span class="token punctuation">(</span> LOGS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLogsAux<span class="token punctuation">(</span> LOGS<span class="token punctuation">,</span> <span class="token punctuation">.</span>StringBuffer <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeLogsAux<span class="token punctuation">(</span> <span class="token punctuation">.</span>List<span class="token punctuation">,</span> OUT <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>String2Bytes<span class="token punctuation">(</span>StringBuffer2String<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">192</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncodeLogsAux<span class="token punctuation">(</span> <span class="token punctuation">(</span> ListItem<span class="token punctuation">(</span><span class="token punctuation">{</span> ACCT <span class="token operator">|</span> TOPICS <span class="token operator">|</span> DATA <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token punctuation">)</span> _
                          <span class="token punctuation">,</span> <span class="token punctuation">(</span> OUT <span class="token operator">=&gt;</span> OUT <span class="token operator">+</span><span class="token keyword">String</span> Bytes2String<span class="token punctuation">(</span>
                              #rlpEncodeLength<span class="token punctuation">(</span>        #rlpEncodeAddress<span class="token punctuation">(</span>ACCT<span class="token punctuation">)</span>
                                                <span class="token operator">+</span>Bytes #rlpEncodeTopics<span class="token punctuation">(</span>TOPICS<span class="token punctuation">,</span><span class="token punctuation">.</span>StringBuffer<span class="token punctuation">)</span>
                                                <span class="token operator">+</span>Bytes #rlpEncodeBytes<span class="token punctuation">(</span>DATA<span class="token punctuation">)</span>
                                               <span class="token punctuation">,</span> <span class="token number">192</span>
                                               <span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token punctuation">)</span>
                          <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeTopics<span class="token punctuation">(</span> <span class="token punctuation">.</span>List<span class="token punctuation">,</span> OUT <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>String2Bytes<span class="token punctuation">(</span>StringBuffer2String<span class="token punctuation">(</span>OUT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">192</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpEncodeTopics<span class="token punctuation">(</span> <span class="token punctuation">(</span> ListItem<span class="token punctuation">(</span> X<span class="token punctuation">:</span><span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List <span class="token punctuation">)</span> _
                         <span class="token punctuation">,</span> <span class="token punctuation">(</span> OUT <span class="token operator">=&gt;</span> OUT <span class="token operator">+</span><span class="token keyword">String</span> Bytes2String<span class="token punctuation">(</span> #rlpEncodeWord<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeTxData <span class="token punctuation">(</span> TxData <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>rlpEncodeTxData<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpEncodeTxData<span class="token punctuation">(</span> LegacyTxData<span class="token punctuation">(</span> TN<span class="token punctuation">,</span> TP<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> TT<span class="token punctuation">,</span> TV<span class="token punctuation">,</span> TD <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> TN<span class="token punctuation">,</span> TP<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>TT<span class="token punctuation">)</span><span class="token punctuation">,</span> TV<span class="token punctuation">,</span> TD <span class="token punctuation">]</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeTxData<span class="token punctuation">(</span> LegacySignedTxData<span class="token punctuation">(</span> TN<span class="token punctuation">,</span> TP<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> TT<span class="token punctuation">,</span> TV<span class="token punctuation">,</span> TD<span class="token punctuation">,</span> B <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> TN<span class="token punctuation">,</span> TP<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>TT<span class="token punctuation">)</span><span class="token punctuation">,</span> TV<span class="token punctuation">,</span> TD<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeTxData<span class="token punctuation">(</span> AccessListTxData<span class="token punctuation">(</span> TN<span class="token punctuation">,</span> TP<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> TT<span class="token punctuation">,</span> TV<span class="token punctuation">,</span> TD<span class="token punctuation">,</span> TC<span class="token punctuation">,</span> <span class="token punctuation">[</span>TA<span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> TC<span class="token punctuation">,</span> TN<span class="token punctuation">,</span> TP<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>TT<span class="token punctuation">)</span><span class="token punctuation">,</span> TV<span class="token punctuation">,</span> TD<span class="token punctuation">,</span> <span class="token punctuation">[</span>TA<span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeTxData<span class="token punctuation">(</span> DynamicFeeTxData<span class="token punctuation">(</span>TN<span class="token punctuation">,</span> TF<span class="token punctuation">,</span> TM<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> TT<span class="token punctuation">,</span> TV<span class="token punctuation">,</span> DATA<span class="token punctuation">,</span> TC<span class="token punctuation">,</span> <span class="token punctuation">[</span>TA<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> TC<span class="token punctuation">,</span> TN<span class="token punctuation">,</span> TF<span class="token punctuation">,</span> TM<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span>TT<span class="token punctuation">)</span><span class="token punctuation">,</span> TV<span class="token punctuation">,</span> DATA<span class="token punctuation">,</span> <span class="token punctuation">[</span>TA<span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>
   
    <span class="token keyword">rule</span> #rlpEncodeTxData<span class="token punctuation">(</span> BlobTxData<span class="token punctuation">(</span>TN<span class="token punctuation">,</span> TF<span class="token punctuation">,</span> TM<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> TT<span class="token punctuation">,</span> TV<span class="token punctuation">,</span> DATA<span class="token punctuation">,</span> CID<span class="token punctuation">,</span> <span class="token punctuation">[</span>TA<span class="token punctuation">]</span><span class="token punctuation">,</span> TB<span class="token punctuation">,</span> TVH<span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncode<span class="token punctuation">(</span> <span class="token punctuation">[</span> CID<span class="token punctuation">,</span> TN<span class="token punctuation">,</span> TF<span class="token punctuation">,</span> TM<span class="token punctuation">,</span> TG<span class="token punctuation">,</span> #addrBytes<span class="token punctuation">(</span><span class="token punctuation">{</span>TT<span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;Account<span class="token punctuation">)</span><span class="token punctuation">,</span> TV<span class="token punctuation">,</span> DATA<span class="token punctuation">,</span> <span class="token punctuation">[</span>TA<span class="token punctuation">]</span><span class="token punctuation">,</span> TB<span class="token punctuation">,</span> <span class="token punctuation">[</span>#parseList2JSONs<span class="token punctuation">(</span>TVH<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpEncodeMerkleTree <span class="token punctuation">(</span> MerkleTree <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpEncodeMerkleTree<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpEncodeMerkleTree <span class="token punctuation">(</span> <span class="token punctuation">.</span>MerkleTree <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> b<span class="token string">"\x80"</span>

    <span class="token keyword">rule</span> #rlpEncodeMerkleTree <span class="token punctuation">(</span> MerkleLeaf <span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>        #rlpEncodeBytes<span class="token punctuation">(</span> #HPEncode<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes #rlpEncodeString<span class="token punctuation">(</span> VALUE <span class="token punctuation">)</span>
                         <span class="token punctuation">,</span> <span class="token number">192</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeMerkleTree <span class="token punctuation">(</span> MerkleExtension <span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>        #rlpEncodeBytes<span class="token punctuation">(</span> #HPEncode<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes #rlpMerkleH<span class="token punctuation">(</span> #rlpEncodeMerkleTree<span class="token punctuation">(</span> TREE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                         <span class="token punctuation">,</span> <span class="token number">192</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #rlpEncodeMerkleTree <span class="token punctuation">(</span> MerkleBranch <span class="token punctuation">(</span> M <span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>        MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span>
                           <span class="token operator">+</span>Bytes #rlpEncodeString<span class="token punctuation">(</span> VALUE <span class="token punctuation">)</span>
                         <span class="token punctuation">,</span> <span class="token number">192</span>
                         <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MerkleMapRLP <span class="token punctuation">(</span> Map <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleMapRLP<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ----------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> MerkleMapRLP<span class="token punctuation">(</span>M<span class="token punctuation">,</span> I<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpMerkleH<span class="token punctuation">(</span> #rlpEncodeMerkleTree<span class="token punctuation">(</span> <span class="token punctuation">{</span> M<span class="token punctuation">[</span>I<span class="token punctuation">]</span> orDefault <span class="token punctuation">.</span>MerkleTree <span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;MerkleTree <span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpMerkleH <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span>function<span class="token punctuation">,</span> <span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleRLPAux<span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpMerkleH <span class="token punctuation">(</span> X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpEncodeBytes<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span> X <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">32</span>

    <span class="token keyword">rule</span> #rlpMerkleH <span class="token punctuation">(</span> X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> X
      <span class="token keyword">requires</span> notBool lengthBytes<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">32</span>
</code></pre>
<h2 id="decoding">Decoding</h2>
<ul>
<li><code>#rlpDecode</code> RLP decodes a single <code>Bytes</code> into a <code>JSON</code>.</li>
<li><code>#rlpDecodeList</code> RLP decodes a single <code>Bytes</code> into a <code>JSONs</code>, interpreting the input as the RLP encoding of a list.</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> JSON <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpDecode <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span>               <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpDecode   <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                  <span class="token operator">|</span> #rlpDecode <span class="token punctuation">(</span> Bytes <span class="token punctuation">,</span> LengthPrefix<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpDecodeAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpDecode<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpDecode<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> #decodeLengthPrefix<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpDecode<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span>  #str<span class="token punctuation">(</span> LEN<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> substrBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> POS <span class="token operator">+</span><span class="token keyword">Int</span> LEN<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpDecode<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> #list<span class="token punctuation">(</span>_LEN<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>#rlpDecodeList<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> JSONs <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpDecodeList <span class="token punctuation">(</span>Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>               <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpDecodeList   <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #rlpDecodeList <span class="token punctuation">(</span>Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> LengthPrefix<span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpDecodeListAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpDecodeList<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpDecodeList<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> #decodeLengthPrefix<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">requires</span> POS &lt;<span class="token keyword">Int</span> lengthBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #rlpDecodeList<span class="token punctuation">(</span>    _<span class="token punctuation">,</span>   _<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>JSONs <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>
    <span class="token keyword">rule</span> #rlpDecodeList<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> _<span class="token punctuation">:</span>LengthPrefixType<span class="token punctuation">(</span>L<span class="token punctuation">,</span> P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #rlpDecode<span class="token punctuation">(</span>substrBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> POS<span class="token punctuation">,</span> L <span class="token operator">+</span><span class="token keyword">Int</span> P<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> #rlpDecodeList<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> L <span class="token operator">+</span><span class="token keyword">Int</span> P<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> LengthPrefixType <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#str"</span> <span class="token operator">|</span> <span class="token string">"#list"</span>
    <span class="token keyword">syntax</span> LengthPrefix <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> LengthPrefixType <span class="token string">"("</span> <span class="token keyword">Int</span> <span class="token string">","</span> <span class="token keyword">Int</span> <span class="token string">")"</span>
                          <span class="token operator">|</span> #decodeLengthPrefix <span class="token punctuation">(</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>                                <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#decodeLengthPrefix<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                          <span class="token operator">|</span> #decodeLengthPrefix <span class="token punctuation">(</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span>                          <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#decodeLengthPrefixAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                          <span class="token operator">|</span> #decodeLengthPrefixLength <span class="token punctuation">(</span> LengthPrefixType <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#decodeLengthPrefixLength<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                          <span class="token operator">|</span> #decodeLengthPrefixLength <span class="token punctuation">(</span> LengthPrefixType <span class="token punctuation">,</span> <span class="token keyword">Int</span>   <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#decodeLengthPrefixLengthAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefix<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> #asWord<span class="token punctuation">(</span>substrBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>    _<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #str<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> START<span class="token punctuation">)</span>                                     <span class="token keyword">requires</span> B0 &lt;<span class="token keyword">Int</span> <span class="token number">128</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>    _<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #str<span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>                    <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">128</span> andBool B0 &lt;<span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">128</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">56</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#str<span class="token punctuation">,</span> BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span>  <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token punctuation">(</span><span class="token number">128</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">56</span><span class="token punctuation">)</span> andBool B0 &lt;<span class="token keyword">Int</span> <span class="token number">192</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>    _<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #list<span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">192</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span>                   <span class="token keyword">requires</span> B0 <span class="token operator">&gt;=</span><span class="token keyword">Int</span> <span class="token number">192</span> andBool B0 &lt;<span class="token keyword">Int</span> <span class="token number">192</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">56</span>
    <span class="token keyword">rule</span> #decodeLengthPrefix<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#list<span class="token punctuation">,</span> BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#str<span class="token punctuation">,</span>  BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#str<span class="token punctuation">,</span>  START<span class="token punctuation">,</span> B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> #asWord<span class="token punctuation">(</span>substrBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">128</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#list<span class="token punctuation">,</span> BYTES<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>#list<span class="token punctuation">,</span> START<span class="token punctuation">,</span> B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">192</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> #asWord<span class="token punctuation">(</span>substrBytes<span class="token punctuation">(</span>BYTES<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token punctuation">(</span>B0 <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">192</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">56</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #decodeLengthPrefixLength<span class="token punctuation">(</span>TYPE<span class="token punctuation">,</span> START<span class="token punctuation">,</span> LL<span class="token punctuation">,</span> L<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TYPE<span class="token punctuation">(</span>L<span class="token punctuation">,</span> START <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token operator">+</span><span class="token keyword">Int</span> LL<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> JSONs <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #rlpDecodeTransaction <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#rlpDecodeTransaction<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #rlpDecodeTransaction<span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range<span class="token punctuation">(</span>T<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> #rlpDecode<span class="token punctuation">(</span>#range<span class="token punctuation">(</span>T<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<h1 id="merkle-patricia-tree">Merkle Patricia Tree</h1>
<ul>
<li>Appendix C and D from the Ethereum Yellow Paper</li>
<li>https://github.com/ethereum/wiki/wiki/Patricia-Tree</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> KItem <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token keyword">Int</span> <span class="token operator">|</span> MerkleTree <span class="token comment">// For testing purposes</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">".MerkleTree"</span>
                        <span class="token operator">|</span> MerkleBranch    <span class="token punctuation">(</span> Map<span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>       <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleBranch   <span class="token punctuation">)</span><span class="token punctuation">]</span>
                        <span class="token operator">|</span> MerkleExtension <span class="token punctuation">(</span> Bytes<span class="token punctuation">,</span> MerkleTree <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleExtension<span class="token punctuation">)</span><span class="token punctuation">]</span>
                        <span class="token operator">|</span> MerkleLeaf      <span class="token punctuation">(</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span>     <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleLeaf     <span class="token punctuation">)</span><span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------------</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MerkleUpdate <span class="token punctuation">(</span> MerkleTree<span class="token punctuation">,</span> <span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleUpdate   <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                        <span class="token operator">|</span> MerkleUpdate <span class="token punctuation">(</span> MerkleTree<span class="token punctuation">,</span>  Bytes<span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleUpdateAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                        <span class="token operator">|</span> MerklePut    <span class="token punctuation">(</span> MerkleTree<span class="token punctuation">,</span>  Bytes<span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerklePut      <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                        <span class="token operator">|</span> MerkleDelete <span class="token punctuation">(</span> MerkleTree<span class="token punctuation">,</span>  Bytes <span class="token punctuation">)</span>         <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleDelete   <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> MerkleUpdate <span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> S<span class="token punctuation">:</span><span class="token keyword">String</span><span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleUpdate <span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> #nibbleize <span class="token punctuation">(</span> String2Bytes<span class="token punctuation">(</span> S <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> MerkleUpdate <span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> PATH<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerklePut <span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token keyword">requires</span> VALUE <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">String</span> <span class="token string">""</span>
    <span class="token keyword">rule</span> MerkleUpdate <span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> PATH<span class="token punctuation">:</span>Bytes<span class="token punctuation">,</span> <span class="token string">""</span>    <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleDelete <span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> PATH <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> <span class="token punctuation">.</span>MerkleTree<span class="token punctuation">,</span>                PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleLeaf<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span>     VALUE <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleLeaf <span class="token punctuation">(</span> LEAFPATH<span class="token punctuation">,</span> _ <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleLeaf<span class="token punctuation">(</span> LEAFPATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> LEAFPATH <span class="token operator">==</span>K PATH

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleLeaf <span class="token punctuation">(</span> LEAFPATH<span class="token punctuation">,</span> LEAFVALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerklePut <span class="token punctuation">(</span> MerklePut <span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> LEAFPATH<span class="token punctuation">,</span> LEAFVALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span> LEAFPATH <span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool lengthBytes<span class="token punctuation">(</span> PATH <span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool LEAFPATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleLeaf <span class="token punctuation">(</span> LEAFPATH<span class="token punctuation">,</span> LEAFVALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #merkleExtensionBuilder<span class="token punctuation">(</span> <span class="token punctuation">.</span>Bytes<span class="token punctuation">,</span> LEAFPATH<span class="token punctuation">,</span> LEAFVALUE<span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> LEAFPATH <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K PATH
       andBool lengthBytes<span class="token punctuation">(</span> LEAFPATH <span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool lengthBytes<span class="token punctuation">(</span> PATH <span class="token punctuation">)</span>     &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool LEAFPATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span><span class="token keyword">Int</span> PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleExtension <span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> EXTTREE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleExtension <span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> MerklePut <span class="token punctuation">(</span> EXTTREE<span class="token punctuation">,</span> <span class="token punctuation">.</span>Bytes<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> EXTPATH <span class="token operator">==</span>K PATH

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleExtension <span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> EXTTREE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #merkleExtensionBrancher<span class="token punctuation">(</span> MerklePut<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> EXTPATH<span class="token punctuation">,</span> EXTTREE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span> PATH <span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool EXTPATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleExtension <span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> EXTTREE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #merkleExtensionSplitter<span class="token punctuation">(</span> <span class="token punctuation">.</span>Bytes<span class="token punctuation">,</span> EXTPATH<span class="token punctuation">,</span> EXTTREE<span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> EXTPATH <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K PATH
       andBool lengthBytes<span class="token punctuation">(</span> PATH <span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool EXTPATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span><span class="token keyword">Int</span> PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span> _ <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span> PATH <span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> MerklePut <span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span> BRANCHVALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #merkleUpdateBranch <span class="token punctuation">(</span> M<span class="token punctuation">,</span> BRANCHVALUE<span class="token punctuation">,</span> PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> #range<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span> PATH <span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> <span class="token punctuation">.</span>MerkleTree<span class="token punctuation">,</span> _ <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>MerkleTree

    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleLeaf<span class="token punctuation">(</span> LPATH<span class="token punctuation">,</span> _V <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>MerkleTree                           <span class="token keyword">requires</span> LPATH <span class="token operator">==</span>K  PATH
    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleLeaf<span class="token punctuation">(</span> LPATH<span class="token punctuation">,</span>  V <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleCheck<span class="token punctuation">(</span> MerkleLeaf<span class="token punctuation">(</span> LPATH<span class="token punctuation">,</span> V <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> LPATH <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K PATH

    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleExtension<span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span> <span class="token keyword">requires</span> notBool <span class="token punctuation">(</span>lengthBytes<span class="token punctuation">(</span>EXTPATH<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token keyword">Int</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> andBool #range<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>EXTPATH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span>K EXTPATH<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleExtension<span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleCheck<span class="token punctuation">(</span> MerkleExtension<span class="token punctuation">(</span> EXTPATH<span class="token punctuation">,</span> MerkleDelete<span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> #range<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>EXTPATH<span class="token punctuation">)</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> lengthBytes<span class="token punctuation">(</span>EXTPATH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>EXTPATH<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token keyword">Int</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> andBool #range<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>EXTPATH<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span>K EXTPATH

    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span> _V <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleCheck<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span>  V <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span> V <span class="token punctuation">)</span>                 <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span> andBool notBool PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> in_keys<span class="token punctuation">(</span>M<span class="token punctuation">)</span>
    <span class="token keyword">rule</span> MerkleDelete<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">,</span>  V <span class="token punctuation">)</span><span class="token punctuation">,</span> PATH <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleCheck<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">[</span>PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>-</span> <span class="token attr-name">MerkleDelete(</span> <span class="token attr-name"><span class="token namespace">{M[PATH[0]]}:</span></span><span class="token punctuation">&gt;</span></span>MerkleTree<span class="token punctuation">,</span> #range<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> V <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span> andBool PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> in_keys<span class="token punctuation">(</span>M<span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MerkleCheck<span class="token punctuation">(</span> MerkleTree <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleCheck<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> TREE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TREE <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleLeaf<span class="token punctuation">(</span> _<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>MerkleTree <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map                   <span class="token punctuation">,</span> V  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleLeaf<span class="token punctuation">(</span> <span class="token punctuation">.</span>Bytes<span class="token punctuation">,</span> V <span class="token punctuation">)</span>                             <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> X <span class="token operator">|</span><span class="token operator">-</span>&gt; T                <span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> #range<span class="token punctuation">(</span>#asByteStack<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> T <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token keyword">requires</span> T <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span>K <span class="token punctuation">.</span>MerkleTree
    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> M <span class="token operator">=&gt;</span> #cleanBranchMap<span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">,</span> _  <span class="token punctuation">)</span>                                                        <span class="token punctuation">)</span> <span class="token keyword">requires</span> <span class="token punctuation">.</span>MerkleTree in values<span class="token punctuation">(</span>M<span class="token punctuation">)</span>

    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleExtension<span class="token punctuation">(</span> _<span class="token punctuation">,</span> <span class="token punctuation">.</span>MerkleTree                                      <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>MerkleTree               <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleExtension<span class="token punctuation">(</span> P1<span class="token punctuation">,</span> MerkleLeaf<span class="token punctuation">(</span> P2<span class="token punctuation">,</span> V <span class="token punctuation">)</span>                             <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleLeaf<span class="token punctuation">(</span> P1 <span class="token operator">+</span>Bytes P2<span class="token punctuation">,</span> V <span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> MerkleCheck<span class="token punctuation">(</span> MerkleExtension<span class="token punctuation">(</span> P1 <span class="token operator">=&gt;</span> P1 <span class="token operator">+</span>Bytes P2<span class="token punctuation">,</span> MerkleExtension<span class="token punctuation">(</span> P2<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TREE <span class="token punctuation">)</span>                              <span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>MerkleUpdateMap</code> Takes a mapping of <code>Bytes |-&gt; String</code> and generates a trie</li>
</ul>
<pre><code class="language-k">    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> MerkleUpdateMap    <span class="token punctuation">(</span> MerkleTree <span class="token punctuation">,</span> Map        <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleUpdateMap<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                        <span class="token operator">|</span> MerkleUpdateMapAux <span class="token punctuation">(</span> MerkleTree <span class="token punctuation">,</span> Map <span class="token punctuation">,</span> List <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>MerkleUpdateMapAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> MerkleUpdateMap<span class="token punctuation">(</span>TREE<span class="token punctuation">,</span> MMAP<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleUpdateMapAux<span class="token punctuation">(</span>TREE<span class="token punctuation">,</span> MMAP<span class="token punctuation">,</span> keys_list<span class="token punctuation">(</span>MMAP<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">rule</span> MerkleUpdateMapAux<span class="token punctuation">(</span>TREE<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token punctuation">.</span>List <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> TREE
    <span class="token keyword">rule</span> MerkleUpdateMapAux<span class="token punctuation">(</span>TREE                                                    <span class="token punctuation">,</span> MMAP<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>KEY<span class="token punctuation">)</span> REST<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleUpdateMapAux<span class="token punctuation">(</span>MerkleUpdate<span class="token punctuation">(</span>TREE<span class="token punctuation">,</span> #nibbleize<span class="token punctuation">(</span>KEY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>MMAP<span class="token punctuation">[</span>KEY<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;<span class="token keyword">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MMAP<span class="token punctuation">,</span>               REST<span class="token punctuation">)</span>
</code></pre>
<h2 id="merkle-tree-aux-functions">Merkle Tree Aux Functions</h2>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #nibbleize <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#nibbleize<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                   <span class="token operator">|</span> #byteify   <span class="token punctuation">(</span> Bytes <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#byteify  <span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #nibbleize <span class="token punctuation">(</span> B <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>          #range<span class="token punctuation">(</span> #asByteStack <span class="token punctuation">(</span> B <span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">/</span><span class="token keyword">Int</span> <span class="token number">16</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span>
                               <span class="token operator">+</span>Bytes <span class="token punctuation">(</span> #range<span class="token punctuation">(</span> #asByteStack <span class="token punctuation">(</span> B <span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span> <span class="token operator">%</span><span class="token keyword">Int</span> <span class="token number">16</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                             <span class="token punctuation">)</span> <span class="token operator">+</span>Bytes #nibbleize <span class="token punctuation">(</span> #range<span class="token punctuation">(</span>B<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #nibbleize <span class="token punctuation">(</span> B <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bytes <span class="token keyword">requires</span> notBool lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #byteify <span class="token punctuation">(</span> B <span class="token punctuation">)</span> <span class="token operator">=&gt;</span>    #range<span class="token punctuation">(</span> #asByteStack <span class="token punctuation">(</span> <span class="token number">16</span> <span class="token operator">*</span><span class="token keyword">Int</span> B<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token keyword">Int</span> B<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token punctuation">)</span>
                       <span class="token operator">+</span>Bytes #byteify <span class="token punctuation">(</span> #range<span class="token punctuation">(</span> B<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #byteify <span class="token punctuation">(</span> B <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>Bytes <span class="token keyword">requires</span> notBool lengthBytes<span class="token punctuation">(</span>B<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #HPEncode <span class="token punctuation">(</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#HPEncode<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #HPEncode <span class="token punctuation">(</span> X<span class="token punctuation">,</span> T <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #asByteStack <span class="token punctuation">(</span> <span class="token number">16</span> <span class="token operator">*</span><span class="token keyword">Int</span> <span class="token punctuation">(</span> HPEncodeAux<span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> <span class="token number">1</span> <span class="token punctuation">)</span> <span class="token operator">+</span><span class="token keyword">Int</span> X<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token operator">+</span>Bytes #byteify<span class="token punctuation">(</span> #range<span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #HPEncode <span class="token punctuation">(</span> X<span class="token punctuation">,</span> T <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #range<span class="token punctuation">(</span>#asByteStack <span class="token punctuation">(</span> <span class="token number">16</span> <span class="token operator">*</span><span class="token keyword">Int</span> HPEncodeAux<span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span>Bytes #byteify<span class="token punctuation">(</span> X <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> notBool lengthBytes<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">%</span><span class="token keyword">Int</span> <span class="token number">2</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> <span class="token keyword">Int</span> <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> HPEncodeAux <span class="token punctuation">(</span> <span class="token keyword">Int</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>HPEncodeAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> HPEncodeAux <span class="token punctuation">(</span> X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">0</span> <span class="token keyword">requires</span>         X <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
    <span class="token keyword">rule</span> HPEncodeAux <span class="token punctuation">(</span> X <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token number">2</span> <span class="token keyword">requires</span> notBool X <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #cleanBranchMap    <span class="token punctuation">(</span> Map <span class="token punctuation">)</span>            <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#cleanBranchMap<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #cleanBranchMapAux <span class="token punctuation">(</span> Map <span class="token punctuation">,</span> List<span class="token punctuation">,</span> Set <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#cleanBranchMapAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #cleanBranchMap<span class="token punctuation">(</span> M <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #cleanBranchMapAux<span class="token punctuation">(</span> M<span class="token punctuation">,</span> keys_list<span class="token punctuation">(</span>M<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>Set <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #cleanBranchMapAux<span class="token punctuation">(</span>                   M<span class="token punctuation">,</span>                        <span class="token punctuation">.</span>List<span class="token punctuation">,</span>                      S <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> removeAll<span class="token punctuation">(</span> M<span class="token punctuation">,</span> S <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #cleanBranchMapAux<span class="token punctuation">(</span> X <span class="token operator">|</span><span class="token operator">-</span>&gt; <span class="token punctuation">.</span>MerkleTree _<span class="token punctuation">,</span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> _    <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">.</span>Set <span class="token operator">=&gt;</span> SetItem<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span> _ <span class="token punctuation">)</span>
    <span class="token keyword">rule</span> #cleanBranchMapAux<span class="token punctuation">(</span>                   _<span class="token punctuation">,</span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> _    <span class="token punctuation">,</span>                      _ <span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #merkleUpdateBranch <span class="token punctuation">(</span> Map<span class="token punctuation">,</span> <span class="token keyword">String</span><span class="token punctuation">,</span> <span class="token keyword">Int</span><span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#merkleUpdateBranch<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #merkleUpdateBranch <span class="token punctuation">(</span> X <span class="token operator">|</span><span class="token operator">-</span>&gt; TREE M<span class="token punctuation">,</span> BRANCHVALUE<span class="token punctuation">,</span> X<span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">[</span>X &lt;<span class="token operator">-</span> MerklePut<span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> BRANCHVALUE <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #merkleUpdateBranch <span class="token punctuation">(</span> M<span class="token punctuation">,</span> BRANCHVALUE<span class="token punctuation">,</span> X<span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">[</span>X &lt;<span class="token operator">-</span> MerkleLeaf<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> BRANCHVALUE <span class="token punctuation">)</span> <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #merkleExtensionBuilder<span class="token punctuation">(</span>    Bytes <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#merkleExtensionBuilder<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                        <span class="token operator">|</span> #merkleExtensionBuilderAux<span class="token punctuation">(</span> Bytes <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">,</span> Bytes <span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#merkleExtensionBuilderAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #merkleExtensionBuilder<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #merkleExtensionBuilderAux<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2<span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool lengthBytes<span class="token punctuation">(</span>P2<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #merkleExtensionBuilder<span class="token punctuation">(</span>PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2<span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> MerklePut<span class="token punctuation">(</span> MerklePut<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1 <span class="token punctuation">)</span><span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2 <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #merkleExtensionBuilderAux<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2 <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #merkleExtensionBuilder<span class="token punctuation">(</span> PATH <span class="token operator">+</span>Bytes <span class="token punctuation">(</span>#range<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                <span class="token punctuation">,</span> #range<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> V1
                                <span class="token punctuation">,</span> #range<span class="token punctuation">(</span>P2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>P2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> V2
                                <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> P1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span><span class="token keyword">Int</span> P2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #merkleExtensionBuilderAux<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2 <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> MerklePut<span class="token punctuation">(</span> MerklePut<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> P1<span class="token punctuation">,</span> V1 <span class="token punctuation">)</span><span class="token punctuation">,</span> P2<span class="token punctuation">,</span> V2 <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token punctuation">[</span>owise<span class="token punctuation">]</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #merkleExtensionBrancher <span class="token punctuation">(</span> MerkleTree<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> MerkleTree <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#merkleExtensionBrancher<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #merkleExtensionBrancher<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span>M<span class="token punctuation">,</span> VALUE<span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> EXTTREE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">[</span>PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>-</span> <span class="token attr-name">MerkleExtension(</span> <span class="token attr-name">#range(PATH,</span> <span class="token attr-name">1,</span> <span class="token attr-name">lengthBytes(PATH)</span> <span class="token attr-name">-Int</span> <span class="token attr-name">1),</span> <span class="token attr-name">EXTTREE</span> <span class="token attr-name">)],</span> <span class="token attr-name">VALUE</span> <span class="token attr-name">)</span>
      <span class="token attr-name">requires</span> <span class="token attr-name">lengthBytes(PATH)</span> <span class="token punctuation">&gt;</span></span><span class="token keyword">Int</span> <span class="token number">1</span>

    <span class="token keyword">rule</span> #merkleExtensionBrancher<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span>M<span class="token punctuation">,</span> VALUE<span class="token punctuation">)</span><span class="token punctuation">,</span> PATH<span class="token punctuation">,</span> EXTTREE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleBranch<span class="token punctuation">(</span> M<span class="token punctuation">[</span>PATH<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> &lt;<span class="token operator">-</span> EXTTREE<span class="token punctuation">]</span><span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>PATH<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">1</span>

    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #merkleExtensionSplitter <span class="token punctuation">(</span> Bytes<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> MerkleTree<span class="token punctuation">,</span> Bytes<span class="token punctuation">,</span> <span class="token keyword">String</span> <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#merkleExtensionSplitter<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ---------------------------------------------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #merkleExtensionSplitter<span class="token punctuation">(</span> PATH <span class="token operator">=&gt;</span> PATH <span class="token operator">+</span>Bytes <span class="token punctuation">(</span>#range<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                 <span class="token punctuation">,</span> P1   <span class="token operator">=&gt;</span> #range<span class="token punctuation">(</span>P1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _
                                 <span class="token punctuation">,</span> P2   <span class="token operator">=&gt;</span> #range<span class="token punctuation">(</span>P2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> lengthBytes<span class="token punctuation">(</span>P2<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token keyword">Int</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> _
                                 <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool lengthBytes<span class="token punctuation">(</span>P2<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool P1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span><span class="token keyword">Int</span> P2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #merkleExtensionSplitter<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> TREE<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> #merkleExtensionBrancher<span class="token punctuation">(</span> MerklePut<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> P2<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> P1<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool lengthBytes<span class="token punctuation">(</span>P2<span class="token punctuation">)</span> &gt;<span class="token keyword">Int</span> <span class="token number">0</span>
       andBool P1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> P2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">rule</span> #merkleExtensionSplitter<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> TREE<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> MerklePut<span class="token punctuation">(</span> TREE<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>P1<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #merkleExtensionSplitter<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> P1<span class="token punctuation">,</span> TREE<span class="token punctuation">,</span> P2<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> MerkleExtension<span class="token punctuation">(</span> PATH<span class="token punctuation">,</span> #merkleExtensionBrancher<span class="token punctuation">(</span> MerklePut<span class="token punctuation">(</span> MerkleBranch<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> <span class="token string">""</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> P2<span class="token punctuation">,</span> VALUE <span class="token punctuation">)</span><span class="token punctuation">,</span> P1<span class="token punctuation">,</span> TREE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> lengthBytes<span class="token punctuation">(</span>P2<span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>
</code></pre>
<h2 id="tree-root-helper-functions">Tree Root Helper Functions</h2>
<h3 id="storage-root">Storage Root</h3>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #intMap2StorageMap<span class="token punctuation">(</span> Map <span class="token punctuation">)</span>               <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#intMap2StorageMap<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #intMap2StorageMapAux<span class="token punctuation">(</span> Map<span class="token punctuation">,</span> Map<span class="token punctuation">,</span> List <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#intMap2StorageMapAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// ------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #intMap2StorageMap<span class="token punctuation">(</span> M <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #intMap2StorageMapAux<span class="token punctuation">(</span> <span class="token punctuation">.</span>Map<span class="token punctuation">,</span> M<span class="token punctuation">,</span> keys_list<span class="token punctuation">(</span>M<span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #intMap2StorageMapAux<span class="token punctuation">(</span> SMAP<span class="token punctuation">,</span> _<span class="token punctuation">,</span> <span class="token punctuation">.</span>List <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> SMAP
    <span class="token keyword">rule</span> #intMap2StorageMapAux<span class="token punctuation">(</span> SMAP<span class="token punctuation">,</span> IMAP<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>K<span class="token punctuation">)</span> REST <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #intMap2StorageMapAux<span class="token punctuation">(</span> #wordBytes<span class="token punctuation">(</span>K<span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">-</span>&gt; Bytes2String<span class="token punctuation">(</span>#rlpEncodeInt<span class="token punctuation">(</span><span class="token punctuation">{</span>IMAP<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;<span class="token keyword">Int</span><span class="token punctuation">)</span><span class="token punctuation">)</span> SMAP<span class="token punctuation">,</span> IMAP<span class="token punctuation">,</span> REST <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> <span class="token punctuation">{</span>IMAP<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;<span class="token keyword">Int</span> <span class="token operator">=</span><span class="token operator">/</span><span class="token operator">=</span><span class="token keyword">Int</span> <span class="token number">0</span>

    <span class="token keyword">rule</span> #intMap2StorageMapAux<span class="token punctuation">(</span> SMAP<span class="token punctuation">,</span> IMAP<span class="token punctuation">,</span> ListItem<span class="token punctuation">(</span>K<span class="token punctuation">)</span> REST <span class="token punctuation">)</span>
      <span class="token operator">=&gt;</span> #intMap2StorageMapAux<span class="token punctuation">(</span> SMAP<span class="token punctuation">,</span> IMAP<span class="token punctuation">,</span> REST <span class="token punctuation">)</span>
      <span class="token keyword">requires</span> <span class="token punctuation">{</span>IMAP<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">:</span>&gt;<span class="token keyword">Int</span> <span class="token operator">==</span><span class="token keyword">Int</span> <span class="token number">0</span>


    <span class="token keyword">syntax</span> MerkleTree <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #storageRoot<span class="token punctuation">(</span> Map <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#storageRoot<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// --------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #storageRoot<span class="token punctuation">(</span> STORAGE <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> MerkleUpdateMap<span class="token punctuation">(</span> <span class="token punctuation">.</span>MerkleTree<span class="token punctuation">,</span> #intMap2StorageMap<span class="token punctuation">(</span> STORAGE <span class="token punctuation">)</span> <span class="token punctuation">)</span>
</code></pre>
<h3 id="state-root">State Root</h3>
<pre><code class="language-k">    <span class="token keyword">syntax</span> Map <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> #precompiledAccountsMap   <span class="token punctuation">(</span> Set <span class="token punctuation">)</span>       <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#precompiledAccountsMap<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
                 <span class="token operator">|</span> #precompiledAccountsMapAux<span class="token punctuation">(</span> List<span class="token punctuation">,</span> Map <span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token class-name">symbol</span><span class="token punctuation">(</span>#precompiledAccountsMapAux<span class="token punctuation">)</span><span class="token punctuation">,</span> function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------------------------------------------------------------</span>
    <span class="token keyword">rule</span> #precompiledAccountsMap<span class="token punctuation">(</span> ACCTS <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> #precompiledAccountsMapAux<span class="token punctuation">(</span> Set2List<span class="token punctuation">(</span> ACCTS <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>Map <span class="token punctuation">)</span>

    <span class="token keyword">rule</span> #precompiledAccountsMapAux<span class="token punctuation">(</span> <span class="token punctuation">.</span>List<span class="token punctuation">,</span> M <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> M
    <span class="token keyword">rule</span> #precompiledAccountsMapAux<span class="token punctuation">(</span> <span class="token punctuation">(</span>ListItem<span class="token punctuation">(</span> ACCT <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">.</span>List<span class="token punctuation">)</span> _<span class="token punctuation">,</span> M <span class="token operator">=&gt;</span> M<span class="token punctuation">[</span>#parseByteStack <span class="token punctuation">(</span> #unparseData<span class="token punctuation">(</span> ACCT<span class="token punctuation">,</span> <span class="token number">20</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> &lt;<span class="token operator">-</span> #emptyContractRLP<span class="token punctuation">]</span> <span class="token punctuation">)</span>

    <span class="token keyword">syntax</span> Bytes <span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">=</span> <span class="token string">"#emptyContractRLP"</span> <span class="token punctuation">[</span>function<span class="token punctuation">]</span>
 <span class="token comment">// -----------------------------------------------</span>
    <span class="token keyword">rule</span> #emptyContractRLP <span class="token operator">=&gt;</span> #rlpEncodeLength<span class="token punctuation">(</span>        #rlpEncodeInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                                                <span class="token operator">+</span>Bytes #rlpEncodeInt<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                                                <span class="token operator">+</span>Bytes #rlpEncodeBytes<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span>b<span class="token string">"\x80"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                                                <span class="token operator">+</span>Bytes #rlpEncodeBytes<span class="token punctuation">(</span> #parseByteStack<span class="token punctuation">(</span> Keccak256<span class="token punctuation">(</span>b<span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span>
                                              <span class="token punctuation">,</span> <span class="token number">192</span>
                                              <span class="token punctuation">)</span>
<span class="token keyword">endmodule</span>
</code></pre>
</body></html></div>
        </main>

        <!-- Page ToC -->
        <div class="col-12 col-md-3 col-xl-2 py-md-3 bd-sidebar page-toc mb-3">
          
<div>
<details style="padding:0.25rem 0;;padding-left: 0px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#parsing%2Funparsing" class="bd-toc-link">Parsing/Unparsing</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#address%2Fhash-helpers"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Address/Hash Helpers
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#parsing"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Parsing
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#unparsing"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Unparsing
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#recursive-length-prefix-(rlp)" class="bd-toc-link">Recursive Length Prefix (RLP)</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#encoding"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Encoding
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#decoding"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Decoding
              </a></div>
            </div>
          </details>
        <details style="padding:0.25rem 0;;padding-left: 0px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#merkle-patricia-tree" class="bd-toc-link">Merkle Patricia Tree</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#merkle-tree-aux-functions"
                class="bd-toc-link"
                style="padding-left: 8px;;"
              >
                Merkle Tree Aux Functions
              </a></div><details style="padding:0.25rem 0;;padding-left: 8px;">
            <summary class="bd-toc-link-wrapper">
              <a href="#tree-root-helper-functions" class="bd-toc-link">Tree Root Helper Functions</a>
              </summary>
            <div>
              <div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#storage-root"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                Storage Root
              </a></div><div class="bd-toc-link-wrapper" style="padding:0.25rem 0;">
              <a
                href="#state-root"
                class="bd-toc-link"
                style="padding-left: 16px;;"
              >
                State Root
              </a></div>
            </div>
          </details>
        
            </div>
          </details>
        
</div>

        </div>
        <div class="btn btn-rv-blue page-toc-toggle-btn"></div>
        <!-- End Page ToC -->
      </div>
    </div>
<!-- The footer is now controlled by the k-web-theme git submodule -->
<footer id="rvsite-footer" class="app-footer text-md-left text-center">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-4 mb-md-0 mb-4">
        <a href="https://runtimeverification.com/" target="_blank">
          <picture>
            <source
              srcset="
                https://runtimeverification.com/assets/img/rv-logo-dark.png
              "
              media="(prefers-color-scheme: dark)"
            />
            <img
              class="logo-dark"
              src="https://runtimeverification.com/assets/img/rv-logo.png"
              alt="Runtime Verification logo"
              style="height: 32px"
            /> </picture
        ></a>
        <p class="mt-2 text-md-left copyright">
          <a href="https://maps.app.goo.gl/8YhKozfmZtgzQBsH7" target="_blank"
            >202 S Broadway Ave #31, Urbana, IL</a
          >
        </p>
      </div>
      <div class="col-md-4 text-md-center mb-md-0 mb-4"></div>
      <div class="col-md-4 mb-md-0 mb-4 pl-0 text-md-right">
        <p class="copyright">2025 © all rights reserved</p>
        <span class="copyright"
          ><a href="https://runtimeverification.com/privacy-policy"
            >privacy policy</a
          >
          |
          <a href="https://runtimeverification.com/terms-of-use"
            >terms of use</a
          ></span
        >
      </div>
    </div>
  </div>
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Typist/1.2/typist.min.js"></script>
    <script src="../../../../../../assets/js/index.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-QL0D8HRYFW"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());
  gtag("config", "G-QL0D8HRYFW");
</script>

  </body>
</html>
